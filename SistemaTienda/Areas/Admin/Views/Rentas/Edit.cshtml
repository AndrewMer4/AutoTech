@model SistemaTienda.Models.ViewModels.RentaVM

@{
    ViewData["Title"] = "Editar Renta";
    var manana = DateTime.Now.AddDays(1).ToString("yyyy-MM-dd");
    var initClienteText = Model.ClienteSearch;
    var initVehiculoText = Model.VehiculoSearch;
}

<!-- Bebas Neue + FontAwesome + Select2 CSS -->
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet" />
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet" />

<style>
    .font-title {
        font-family: 'Bebas Neue', sans-serif;
        letter-spacing: 1px;
    }

    .form-container {
        background: #f9f9f9;
        border-radius: 1rem;
        padding: 2rem;
        box-shadow: 0 0 15px rgba(0,0,0,0.07);
        height: 100%;
    }

    .form-label {
        font-weight: 600;
        color: #333;
    }

    .form-control, .select2-container--default .select2-selection--single {
        border-radius: .5rem !important;
        height: 38px;
        border: 1px solid #ced4da !important;
    }

    .input-group-text {
        background: #e9ecef;
    }

    .btn-dark {
        font-weight: 500;
        padding: 10px 25px;
        background: #343a40;
        border: none;
    }

        .btn-dark:hover {
            background: #23272b;
        }
    /* Sidebar */
    .vehicle-sidebar {
        position: sticky;
        top: 1rem;
        height: calc(100vh - 2rem);
        overflow-y: auto;
        padding: 1rem;
        background: #fff;
        border-left: 1px solid #e0e0e0;
    }

    .vehicle-card {
        border-bottom: 1px solid #ddd;
        padding-bottom: .5rem;
        margin-bottom: .5rem;
    }

        .vehicle-card img {
            width: 100%;
            object-fit: cover;
            border-radius: .5rem;
        }
</style>

<div class="container-fluid mt-5">
    <div class="row">
        <!-- FORMULARIO IZQUIERDA -->
        <div class="col-lg-9">
            <div class="form-container">
                <h1 class="text-center display-4 font-title mb-4">Editar Renta</h1>

                <form asp-area="Admin"
                      asp-controller="Rentas"
                      asp-action="Edit"
                      method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" asp-for="Renta.Id" />

                    <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                    <!-- Cliente -->
                    <div class="mb-3">
                        <label asp-for="Renta.ClienteId" class="form-label">Cliente</label>
                        <select asp-for="Renta.ClienteId"
                                class="form-control js-select2-client"
                                data-url="@Url.Action("GetClientes","Rentas", new { area="Admin" })"
                                data-init-id="@Model.Renta.ClienteId"
                                data-init-text="@initClienteText"
                                data-placeholder="Escriba para buscar cliente…">
                            <option></option>
                        </select>
                        <span asp-validation-for="Renta.ClienteId" class="text-danger"></span>
                    </div>

                    <!-- Vehículo -->
                    <div class="mb-3">
                        <label asp-for="Renta.VehiculoId" class="form-label">Vehículo</label>
                        <select asp-for="Renta.VehiculoId"
                                class="form-control js-select2-vehiculo"
                                data-url="@Url.Action("GetVehiculos","Rentas", new { area="Admin" })"
                                data-init-id="@Model.Renta.VehiculoId"
                                data-init-text="@initVehiculoText"
                                data-placeholder="Escriba para buscar vehículo…">
                            <option></option>
                        </select>
                        <span asp-validation-for="Renta.VehiculoId" class="text-danger"></span>
                    </div>

                    <!-- Fechas lado a lado -->
                    <div class="row mb-3">
                        <div class="col">
                            <label asp-for="Renta.FechaInicio" class="form-label">Fecha Inicio</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                                <input asp-for="Renta.FechaInicio"
                                       type="date"
                                       class="form-control"
                                       readonly />
                            </div>
                            <span asp-validation-for="Renta.FechaInicio" class="text-danger"></span>
                        </div>
                        <div class="col">
                            <label asp-for="Renta.FechaFin" class="form-label">Fecha Fin</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                                <input asp-for="Renta.FechaFin"
                                       type="date"
                                       class="form-control"
                                       min="@manana" />
                            </div>
                            <span asp-validation-for="Renta.FechaFin" class="text-danger"></span>
                        </div>
                    </div>

                    <!-- Total -->
                    <div class="mb-4">
                        <label asp-for="Renta.Total" class="form-label">Total Estimado</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input asp-for="Renta.Total" class="form-control" readonly />
                        </div>
                    </div>

                    <!-- Botones -->
                    <div class="d-flex justify-content-between">
                        <a asp-action="Index" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i> Volver
                        </a>
                        <button type="submit" class="btn btn-dark">
                            <i class="fas fa-save me-2"></i> Guardar Cambios
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- SIDEBAR DERECHA -->
        <div class="col-lg-3">
            <aside class="vehicle-sidebar">
                <h5 class="mb-3">Vehículos Disponibles</h5>
                @foreach (var v in Model.VehiculosDisponibles)
                {
                    <div class="vehicle-card">
                        <img src="@v.UrlImagen" alt="@v.Placa" />
                        <div><strong>Placa:</strong> @v.Placa</div>
                        <div><strong>Marca/Modelo:</strong> @v.Marca @v.Modelo</div>
                        <div><strong>Precio/día:</strong> $@v.PrecioPorDia</div>
                    </div>
                }
            </aside>
        </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(function() {
          function initSelect2(selector) {
            var $el = $(selector);
            $el.select2({
              placeholder: $el.data('placeholder'),
              allowClear: true,
              ajax: {
                url: $el.data('url'),
                dataType: 'json',
                delay: 250,
                data: params => ({ term: params.term }),
                processResults: data => ({ results: data.results })
              },
              minimumInputLength: 1,
              width: '100%'
            });

            // Preselección
            var id   = $el.data('init-id'),
                text = $el.data('init-text');
            if (id && text) {
              var option = new Option(text, id, true, true);
              $el.append(option).trigger('change');
            }
          }
          initSelect2('.js-select2-client');
          initSelect2('.js-select2-vehiculo');
        });
    </script>
}
