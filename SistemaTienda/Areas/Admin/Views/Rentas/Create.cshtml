@model SistemaTienda.Models.ViewModels.RentaVM

@{
    ViewData["Title"] = "Registrar Renta";
    var hoy = DateTime.Now.ToString("yyyy-MM-dd");
    var manana = DateTime.Now.AddDays(1).ToString("yyyy-MM-dd");
}

<!-- Select2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<style>
    .select2-container--default .select2-selection--single {
        height: 38px;
        border: 1px solid #ced4da !important;
        border-radius: 0.5rem !important;
    }

        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 36px;
        }

    .form-label {
        font-weight: 600;
        color: #333;
    }

    .form-control {
        border-radius: .5rem;
    }

    .btn-dark {
        font-weight: 500;
        padding: 10px 25px;
    }
</style>

<div class="container mt-5">
    <h1 class="text-center display-4 mb-4">Registrar Renta</h1>

    <form method="post" asp-area="Admin" asp-controller="Rentas" asp-action="Create">
        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

        <!-- Cliente (Select2 + AJAX) -->
        <div class="mb-3">
            <label asp-for="Renta.ClienteId" class="form-label">Cliente</label>
            <select asp-for="Renta.ClienteId"
                    class="form-control js-select2-client">
                <option value="">Escriba para buscar…</option>
            </select>
            <span asp-validation-for="Renta.ClienteId" class="text-danger"></span>
        </div>

        <!-- Vehículo (Select2 + AJAX) -->
        <div class="mb-3">
            <label asp-for="Renta.VehiculoId" class="form-label">Vehículo</label>
            <select asp-for="Renta.VehiculoId"
                    class="form-control js-select2-vehiculo">
                <option value="">Escriba para buscar…</option>
            </select>
            <span asp-validation-for="Renta.VehiculoId" class="text-danger"></span>
        </div>

        <!-- Fechas y Total -->
        <div class="mb-3">
            <label asp-for="Renta.FechaInicio" class="form-label"></label>
            <input asp-for="Renta.FechaInicio" type="date"
                   class="form-control" min="@hoy" value="@hoy" readonly />
        </div>
        <div class="mb-3">
            <label asp-for="Renta.FechaFin" class="form-label"></label>
            <input asp-for="Renta.FechaFin" type="date"
                   class="form-control" min="@manana" value="@manana" />
        </div>
        <div class="mb-4">
            <label asp-for="Renta.Total" class="form-label"></label>
            <input asp-for="Renta.Total" class="form-control" readonly />
        </div>

        <div class="d-flex justify-content-between">
            <a asp-area="Admin" asp-controller="Rentas" asp-action="Index"
               class="btn btn-secondary">
                <i class="fas fa-arrow-left me-1"></i> Volver
            </a>
            <button type="submit" class="btn btn-dark">
                <i class="fas fa-car me-2"></i> Registrar
            </button>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(function() {
          $('.js-select2-client').select2({
            placeholder: "Escriba para buscar cliente…",
            allowClear: true,
            ajax: {
              url: '@Url.Action("GetClientes", "Rentas", new { area = "Admin" })',
              dataType: 'json',
              delay: 250,
              data: params => ({ term: params.term }),
              processResults: data => data
            },
            minimumInputLength: 1,
            width: '100%'
          });

          $('.js-select2-vehiculo').select2({
            placeholder: "Escriba para buscar vehículo…",
            allowClear: true,
            ajax: {
              url: '@Url.Action("GetVehiculos", "Rentas", new { area = "Admin" })',
              dataType: 'json',
              delay: 250,
              data: params => ({ term: params.term }),
              processResults: data => data
            },
            minimumInputLength: 1,
            width: '100%'
          });
        });
    </script>
}
